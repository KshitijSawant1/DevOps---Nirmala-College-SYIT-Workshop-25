<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CCT1</title>
  <meta name="description" content="Pick two colors, check WCAG contrast, and preview UI components.">
  <style>
    :root{
      --bg:#7c2d12;
      --fg:#ffedd5;
      --surface: #ffffff;
      --surface-2: #f4f4f5;
      --muted:#6b7280;
      --ok:#059669;
      --warn:#d97706;
      --bad:#dc2626;
      --ring:#3b82f6;
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font: 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      color:#0b0f14;
      background:#fafafa;
    }
    .container{
      width:min(1200px, 94vw);
      margin: 28px auto 48px;
      display:grid;
      grid-template-columns: 1fr;
      gap:20px;
    }
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:16px 18px;border-radius:var(--radius);
      background:var(--surface);
      border:1px solid #e5e7eb;
      position:sticky;top:10px;z-index:1;backdrop-filter:saturate(1.2) blur(4px);
    }
    h1{font-size: clamp(20px, 2.2vw, 26px); margin: 0}
    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .swatch{
      width:28px;height:28px;border-radius:8px;border:1px solid #e5e7eb;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .controls{
      display:grid; gap:14px;
      grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
      background:var(--surface);
      border:1px solid #e5e7eb;border-radius:var(--radius);
      padding:16px;
    }
    .control{
      border:1px dashed #e5e7eb;border-radius:12px;padding:12px;
      display:grid; grid-template-columns: 92px 1fr; gap:12px; align-items:center;
      background:#fff;
    }
    .control label{font-size:13px;color:#374151}
    .row{display:flex; gap:8px; align-items:center}
    input[type="text"]{
      width:110px;
      padding:10px 12px;border-radius:10px;border:1px solid #e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    input[type="color"]{
      width:52px;height:38px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;padding:0;
    }
    button{
      appearance:none;border:1px solid #e5e7eb;background:#fff;color:#111827;
      padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600;
      transition: transform .04s ease, box-shadow .12s ease;
    }
    button:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}
    button:active{transform:translateY(1px)}
    .btn-primary{background:#111827;color:#fff;border-color:#111827}
    .btn-ghost{background:transparent}
    .badges{display:flex; gap:8px; flex-wrap:wrap}
    .badge{
      font-size:12px;font-weight:700;letter-spacing:.02em;text-transform:uppercase;
      border-radius:999px;padding:6px 10px;border:1px solid;
    }
    .badge.ok{color:var(--ok);border-color:var(--ok);background: #10b98114}
    .badge.warn{color:var(--warn);border-color:var(--warn);background:#f59e0b14}
    .badge.bad{color:var(--bad);border-color:var(--bad);background:#ef444414}
    .grid{
      display:grid; gap:16px;
      grid-template-columns: repeat(12, 1fr);
    }
    section.card{
      grid-column: span 12;
      background:var(--surface);border:1px solid #e5e7eb;border-radius:var(--radius);
      padding:18px;
    }
    @media (min-width: 1000px){
      #preview.card{grid-column: span 5}
      #code.card{grid-column: span 3}
      #report.card{grid-column: span 4}
    }
    .preview-wrap{
      border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;
    }
    .preview-toolbar{
      display:flex;gap:8px;justify-content:space-between;align-items:center;
      padding:10px;background:#f8fafc;border-bottom:1px solid #e5e7eb;
    }
    .split{
      display:grid;grid-template-columns: 1fr 1fr; gap:0;border-top:1px solid #e5e7eb;
    }
    .split > div{min-height:260px;display:flex;align-items:center;justify-content:center}
    .pane{padding:18px}
    .pane h3{margin:0 0 6px;font-size:18px}
    .card-ui{
      width:min(420px, 90%);border-radius:14px;border:1px solid #e5e7eb;background:#fff;padding:16px;
      box-shadow:0 6px 40px rgba(0,0,0,.06);
    }
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;font-size:12px}
    .muted{color:#6b7280}
    .sp{height:10px}
    .hr{height:1px;background:#e5e7eb;margin:10px 0}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap}
    .hl{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px; background:#0b1020; color:#e2e8f0; border-radius:10px; padding:12px;
      overflow:auto; max-height:280px; white-space:pre;
    }
    .copy{
      display:flex;justify-content:space-between;align-items:center;margin-top:10px;
    }
    .meter{
      display:grid;gap:8px;margin-top:4px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .tile{
      border:1px solid #e5e7eb;border-radius:10px;padding:10px;background:#fff
    }
    .tile h4{margin:0 0 6px;font-size:14px;color:#374151}
    .kv{display:flex;justify-content:space-between;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;}
    .ratio{font-size:28px;font-weight:800}
    .sub{font-size:12px;color:#6b7280}
    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px}
    .legend span{font-size:12px;color:#6b7280}
    .sw{width:14px;height:14px;border-radius:4px;border:1px solid #e5e7eb;display:inline-block}
    .mini-grid{display:grid;grid-template-columns:repeat(10, 1fr);gap:8px;margin-top:12px}
    .mini{height:28px;border-radius:6px;border:1px solid #e5e7eb;position:relative;overflow:hidden}
    .mini::after{content:attr(data-ok);position:absolute;inset:auto 6px 4px auto;font-size:10px;color:#111;background:#ffffffb3;padding:2px 6px;border-radius:999px;display:var(--show, none)}
    .mini.pass{--show:block}
    footer{color:#6b7280;text-align:center;margin: 12px auto}
    .link{color:#2563eb;text-decoration:none}
    .ring:focus{outline: none; box-shadow: 0 0 0 4px #93c5fd66}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="swatch" id="sw-bg" title="Background"></div>
        <div class="swatch" id="sw-fg" title="Foreground"></div>
        <h1>Color Combo Lab</h1>
      </div>
      <div class="badges" id="status-badges"></div>
    </header>

    <section class="controls" aria-label="Pick colors">
      <div class="control">
        <label for="bgHex">Background</label>
        <div class="row">
          <input id="bgPicker" class="ring" type="color" aria-label="Pick background color">
          <input id="bgHex" class="ring" type="text" value="#7c2d12" aria-label="Background color hex">
          <button id="bgAuto" title="Pick readable FG" class="btn-ghost ring">Suggest FG</button>
        </div>
      </div>
      <div class="control">
        <label for="fgHex">Foreground</label>
        <div class="row">
          <input id="fgPicker" class="ring" type="color" aria-label="Pick foreground color">
          <input id="fgHex" class="ring" type="text" value="#ffedd5" aria-label="Foreground color hex">
          <button id="swap" class="ring">Swap</button>
        </div>
      </div>
      <div class="control">
        <label>Actions</label>
        <div class="row">
          <button id="randomize" class="ring">Random</button>
          <button id="invert" class="ring">Invert Preview</button>
          <button id="saveLink" class="ring btn-primary">Share Link</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <section id="preview" class="card">
        <h2 style="margin:0 0 12px">Preview</h2>
        <div class="preview-wrap">
          <div class="preview-toolbar">
            <div class="row muted">
              <span>UI Preview â€¢ <span id="previewMode">Normal</span></span>
            </div>
            <div class="row">
              <span class="chip"><span class="sw" id="chip-bg"></span> BG</span>
              <span class="chip"><span class="sw" id="chip-fg"></span> FG</span>
            </div>
          </div>

          <div class="split" id="split">
            <div class="pane" id="pane-left">
              <div class="card-ui" id="ui-normal">
                <div class="chip">Badge</div>
                <h3 style="margin-top:10px" id="h3">Heading</h3>
                <p class="muted" id="p1">Use the controls to test your foreground and background colors. The card below shows buttons, links, and small elements.</p>
                <div class="sp"></div>
                <div class="btn-row">
                  <button class="btn-primary ring" id="btnPrimary">Primary</button>
                  <button class="ring" id="btnSecondary">Secondary</button>
                  <button class="btn-ghost ring" id="btnGhost">Ghost</button>
                </div>
                <div class="hr"></div>
                <div class="muted">Link Example: <a href="#" id="demoLink" class="link">Learn more</a></div>
              </div>
            </div>

            <div class="pane" id="pane-right" style="background:#fff">
              <svg viewBox="0 0 200 200" width="200" height="200" role="img" aria-label="Donut chart" id="donut">
                <circle cx="100" cy="100" r="80" fill="var(--bg)"></circle>
                <circle cx="100" cy="100" r="50" fill="var(--surface)"></circle>
                <text x="100" y="106" text-anchor="middle" font-size="18" font-weight="700" fill="var(--fg)">FG</text>
              </svg>
            </div>
          </div>
        </div>
      </section>

      <section id="code" class="card">
        <h2 style="margin:0 0 12px">CSS Variables</h2>
        <div class="hl" id="cssOut"></div>
        <div class="copy">
          <div class="muted">Copy & paste into your stylesheet.</div>
          <button id="copyCss" class="ring">Copy</button>
        </div>

        <h2 style="margin:14px 0 8px">Accessible Suggestions</h2>
        <div class="mini-grid" id="suggestions"></div>
      </section>

      <section id="report" class="card">
        <h2 style="margin:0 0 12px">Contrast Report (WCAG 2.1)</h2>
        <div class="meter">
          <div class="tile">
            <h4>Contrast Ratio</h4>
            <div class="ratio" id="ratio">â€“</div>
            <div class="legend">
              <span><span class="sw" id="lg-bg"></span> BG</span>
              <span><span class="sw" id="lg-fg"></span> FG</span>
            </div>
          </div>
          <div class="tile">
            <h4>Pass/Fail</h4>
            <div class="badges" id="pf"></div>
            <div class="sub">AA: 4.5 normal / 3.0 large â€¢ AAA: 7.0 normal / 4.5 large</div>
          </div>
        </div>

        <h3 style="margin:12px 0 6px">Breakdown</h3>
        <div class="tile">
          <div class="kv"><span>Foreground luminance</span><span id="lumFg">â€“</span></div>
          <div class="kv"><span>Background luminance</span><span id="lumBg">â€“</span></div>
          <div class="kv"><span>Delta (L1 â€“ L2)</span><span id="lumDelta">â€“</span></div>
        </div>
      </section>
    </div>

    <footer>
      Built for quick color checks. Uses WCAG 2.1 relative luminance & contrast formulas.
    </footer>
  </div>

<script>
  // ---------- Utilities
  const clamp = (v, lo, hi) => Math.min(Math.max(v, lo), hi);
  const el = id => document.getElementById(id);
  const $ = sel => document.querySelector(sel);

  function hexToRgb(hex){
    hex = hex.trim();
    if(!hex) return null;
    if(hex[0] !== '#') hex = '#' + hex;
    if(hex.length === 4){ // #abc -> #aabbcc
      hex = '#' + [...hex.slice(1)].map(x => x+x).join('');
    }
    const m = /^#([0-9a-f]{6})$/i.exec(hex);
    if(!m) return null;
    const int = parseInt(m[1], 16);
    return { r: (int>>16)&255, g: (int>>8)&255, b: int&255, hex };
  }

  function rgbToHex({r,g,b}){
    const h = (n)=> n.toString(16).padStart(2,'0');
    return '#' + h(r) + h(g) + h(b);
  }

  function srgbToLinear(c){
    c = c/255;
    return c <= 0.03928 ? c/12.92 : Math.pow((c+0.055)/1.055, 2.4);
  }

  function luminance({r,g,b}){
    const R = srgbToLinear(r);
    const G = srgbToLinear(g);
    const B = srgbToLinear(b);
    return 0.2126*R + 0.7152*G + 0.0722*B;
  }

  function contrastRatio(fg, bg){
    const L1 = luminance(fg);
    const L2 = luminance(bg);
    const [hi, lo] = L1 >= L2 ? [L1, L2] : [L2, L1];
    return (hi + 0.05) / (lo + 0.05);
  }

  function hslToRgb(h, s, l){
    h = (h%360 + 360)%360;
    s = clamp(s,0,1); l = clamp(l,0,1);
    if(s===0) return {r: l*255, g: l*255, b: l*255};
    const q = l < 0.5 ? l*(1+s) : l + s - l*s;
    const p = 2*l - q;
    const hk = h/360;
    const tc = [hk+1/3, hk, hk-1/3];
    const c = tc.map(t => {
      t = (t%1 + 1)%1;
      if(t < 1/6) return p + (q-p)*6*t;
      if(t < 1/2) return q;
      if(t < 2/3) return p + (q-p)*(2/3 - t)*6;
      return p;
    });
    return { r: Math.round(c[0]*255), g: Math.round(c[1]*255), b: Math.round(c[2]*255) };
  }

  function rgbToHsl({r,g,b}){
    r/=255; g/=255; b/=255;
    const max = Math.max(r,g,b), min = Math.min(r,g,b);
    let h, s, l = (max+min)/2;
    if(max===min){ h = s = 0; }
    else{
      const d = max - min;
      s = l>0.5 ? d/(2-max-min) : d/(max+min);
      switch(max){
        case r: h = (g-b)/d + (g<b?6:0); break;
        case g: h = (b-r)/d + 2; break;
        case b: h = (r-g)/d + 4; break;
      }
      h *= 60;
    }
    return {h, s, l};
  }

  function isValidHex(s){
    return /^#?([0-9a-f]{3}|[0-9a-f]{6})$/i.test(s);
  }

  function fmt(n, digits=3){
    return Number(n).toFixed(digits);
  }

  // ---------- DOM & State
  const bgPicker = el('bgPicker');
  const fgPicker = el('fgPicker');
  const bgHex = el('bgHex');
  const fgHex = el('fgHex');

  function setSwatches(bg, fg){
    el('sw-bg').style.background = bg;
    el('sw-fg').style.background = fg;
    el('chip-bg').style.background = bg;
    el('chip-fg').style.background = fg;
    el('lg-bg').style.background = bg;
    el('lg-fg').style.background = fg;
    document.documentElement.style.setProperty('--bg', bg);
    document.documentElement.style.setProperty('--fg', fg);

    // Update preview card theming
    const card = el('ui-normal');
    card.style.color = fg;
    card.style.background = bg;
    card.style.borderColor = bg;
    el('btnPrimary').style.background = fg;
    el('btnPrimary').style.color = bg;
    el('btnSecondary').style.borderColor = fg;
    el('btnSecondary').style.color = fg;
    el('btnGhost').style.color = fg;
    el('demoLink').style.color = fg;
    el('donut').querySelector('circle').setAttribute('fill', bg);
    el('donut').querySelector('text').setAttribute('fill', fg);
  }

  function badges({ratio}){
    const pf = el('pf');
    pf.innerHTML = '';
    const items = [
      {label:'AA Normal', pass: ratio >= 4.5},
      {label:'AA Large', pass: ratio >= 3.0},
      {label:'AAA Normal', pass: ratio >= 7.0},
      {label:'AAA Large', pass: ratio >= 4.5},
    ];
    const frag = document.createDocumentFragment();
    items.forEach(i => {
      const b = document.createElement('div');
      b.className = 'badge ' + (i.pass ? 'ok' : 'bad');
      b.textContent = i.label + ' ' + (i.pass ? 'PASS' : 'FAIL');
      frag.appendChild(b);
    });
    pf.appendChild(frag);

    const status = el('status-badges');
    status.innerHTML = '';
    const overall = document.createElement('div');
    overall.className = 'badge ' + (ratio >= 4.5 ? 'ok' : ratio >= 3 ? 'warn' : 'bad');
    overall.textContent = 'Contrast ' + fmt(ratio,2) + ':1';
    status.appendChild(overall);
  }

  function update(){
    const bg = hexToRgb(bgHex.value);
    const fg = hexToRgb(fgHex.value);
    if(!bg || !fg) return;

    bgPicker.value = bg.hex;
    fgPicker.value = fg.hex;
    setSwatches(bg.hex, fg.hex);

    const Lbg = luminance(bg);
    const Lfg = luminance(fg);
    const ratio = contrastRatio(fg, bg);

    el('ratio').textContent = fmt(ratio,2) + ':1';
    el('lumFg').textContent = fmt(Lfg,6);
    el('lumBg').textContent = fmt(Lbg,6);
    el('lumDelta').textContent = fmt(Math.abs(Lfg - Lbg),6);

    badges({ratio});
    renderCssOutput(bg.hex, fg.hex);
    renderSuggestions(bg, fg);
    try { localStorage.setItem('colorComboLab', JSON.stringify({bg:bg.hex, fg:fg.hex})); } catch {}
  }

  function renderCssOutput(bg, fg){
    const css = `:root {
  --color-bg: ${bg};
  --color-fg: ${fg};
}

/* Normal theme */
.theme-1 {
  color: var(--color-fg);
  background-color: var(--color-bg);
}

/* Inverse theme */
.theme-2 {
  color: var(--color-bg);
  background-color: var(--color-fg);
}`;
    el('cssOut').textContent = css;
  }

  function copyCss(){
    navigator.clipboard.writeText(el('cssOut').textContent).then(() => {
      const btn = el('copyCss');
      const prev = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(()=> btn.textContent = prev, 1200);
    });
  }

  function randomHex(){
    const r = () => Math.floor(Math.random()*256);
    return rgbToHex({r:r(), g:r(), b:r()});
  }

  function randomize(){
    bgHex.value = randomHex();
    fgHex.value = randomHex();
    update();
  }

  function swap(){
    const b = bgHex.value;
    bgHex.value = fgHex.value;
    fgHex.value = b;
    update();
  }

  function invertPreview(){
    const left = el('pane-left');
    const right = el('pane-right');
    const mode = el('previewMode');
    if(left.style.filter){
      left.style.filter = ''; right.style.filter = ''; mode.textContent = 'Normal';
    } else {
      left.style.filter = 'invert(1) hue-rotate(180deg)';
      right.style.filter = 'invert(1) hue-rotate(180deg)';
      mode.textContent = 'Inverted';
    }
  }

  function shareLink(){
    const bg = bgHex.value.replace('#','');
    const fg = fgHex.value.replace('#','');
    const url = new URL(window.location.href);
    url.searchParams.set('bg', bg);
    url.searchParams.set('fg', fg);
    navigator.clipboard.writeText(url.toString()).then(()=>{
      const btn = el('saveLink');
      const prev = btn.textContent;
      btn.textContent = 'Link Copied';
      setTimeout(()=> btn.textContent = prev, 1300);
    });
  }

  // Accessible suggestions: keep hue, vary lightness until threshold
  function renderSuggestions(bgRGB, fgRGB){
    const container = el('suggestions');
    container.innerHTML='';
    const bgHSL = rgbToHsl(bgRGB);
    const fgHSL = rgbToHsl(fgRGB);

    const targets = [
      {name:'AA Normal (4.5)', min:4.5},
      {name:'AAA Normal (7.0)', min:7.0},
    ];

    const makeTile = (hex, name, ok) => {
      const d = document.createElement('div');
      d.className = 'mini ' + (ok ? 'pass' : '');
      d.style.background = hex;
      d.dataset.ok = ok ? 'PASS' : '';
      d.title = name + ' â€¢ ' + hex;
      container.appendChild(d);
    };

    // generate 10 candidates by lightening/darkening FG
    const variants = [];
    for(let i=-5;i<=5;i++){
      const l = clamp(fgHSL.l + i*0.05, 0, 1);
      variants.push(hslToRgb(fgHSL.h, fgHSL.s, l));
    }
    const bg = bgRGB;
    const bgHex = rgbToHex(bg);

    variants.forEach(v => {
      const hex = rgbToHex(v);
      const ratio = contrastRatio(v, bg);
      // Pick the best target name that passes
      let tag = '';
      for(const t of targets){
        if(ratio >= t.min){ tag = t.name; }
      }
      makeTile(`linear-gradient(90deg, ${bgHex} 50%, ${hex} 50%)`, tag, ratio>=4.5);
    });
  }

  function suggestFG(){
    // choose fg as either near-black or near-white whichever gives higher contrast
    const bg = hexToRgb(bgHex.value);
    const black = {r:0,g:0,b:0};
    const white = {r:255,g:255,b:255};
    const cBlack = contrastRatio(black,bg);
    const cWhite = contrastRatio(white,bg);
    const chosen = cBlack > cWhite ? black : white;
    // nudge a little to avoid absolute extremes (nice aesthetic)
    const hsl = rgbToHsl(chosen);
    hsl.l = clamp(chosen===black ? 0.06 : 0.94, 0, 1);
    const nudged = hslToRgb(hsl.h, hsl.s, hsl.l);
    fgHex.value = rgbToHex(nudged);
    update();
  }

  // ---------- Bindings
  bgPicker.addEventListener('input', e => { bgHex.value = e.target.value; update(); });
  fgPicker.addEventListener('input', e => { fgHex.value = e.target.value; update(); });
  bgHex.addEventListener('input', e => { if(isValidHex(e.target.value)) update(); });
  fgHex.addEventListener('input', e => { if(isValidHex(e.target.value)) update(); });
  el('swap').addEventListener('click', swap);
  el('invert').addEventListener('click', invertPreview);
  el('randomize').addEventListener('click', randomize);
  el('saveLink').addEventListener('click', shareLink);
  el('copyCss').addEventListener('click', copyCss);
  el('bgAuto').addEventListener('click', suggestFG);

  // ---------- Init
  (function init(){
    // load from URL or localStorage
    const url = new URL(window.location.href);
    const bgQ = url.searchParams.get('bg');
    const fgQ = url.searchParams.get('fg');
    if(bgQ && fgQ){
      bgHex.value = '#' + bgQ;
      fgHex.value = '#' + fgQ;
    } else {
      try{
        const last = JSON.parse(localStorage.getItem('colorComboLab')||'{}');
        if(last.bg && last.fg){
          bgHex.value = last.bg;
          fgHex.value = last.fg;
        }
      } catch {}
    }
    // set pickers and swatches then update
    bgPicker.value = bgHex.value;
    fgPicker.value = fgHex.value;
    setSwatches(bgHex.value, fgHex.value);
    update();
  })();
</script>
</body>
</html>
